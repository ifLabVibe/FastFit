<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ËøêÂä®ËøΩË∏™ - ÂÆûÊó∂ËÆ∞ÂΩï</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 0;
        }

        .workout-container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .workout-type {
            font-size: 18px;
            opacity: 0.9;
        }

        .timer-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .timer-display {
            font-size: 48px;
            font-weight: bold;
            color: #2ECC71;
            margin-bottom: 10px;
            font-variant-numeric: tabular-nums;
        }

        .timer-status {
            font-size: 16px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        .control-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .control-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        .btn-start {
            background: #2ECC71;
            color: white;
        }

        .btn-start:hover {
            background: #27ae60;
        }

        .btn-pause {
            background: #f39c12;
            color: white;
        }

        .btn-pause:hover {
            background: #e67e22;
        }

        .btn-stop {
            background: #e74c3c;
            color: white;
        }

        .btn-stop:hover {
            background: #c0392b;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .stat-icon {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2ECC71;
            margin-bottom: 5px;
            font-variant-numeric: tabular-nums;
        }

        .stat-label {
            font-size: 14px;
            color: #7f8c8d;
        }

        .heart-rate-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .heart-rate-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .heart-icon {
            font-size: 32px;
            color: #e74c3c;
            animation: heartbeat 1.5s ease-in-out infinite;
        }

        @keyframes heartbeat {
            0% { transform: scale(1); }
            25% { transform: scale(1.1); }
            50% { transform: scale(1); }
            75% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .heart-rate-value {
            font-size: 36px;
            font-weight: bold;
            color: #e74c3c;
            font-variant-numeric: tabular-nums;
        }

        .heart-rate-unit {
            font-size: 14px;
            color: #7f8c8d;
            margin-left: 5px;
        }

        .heart-rate-zone {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .zone-fat-burn {
            background: #d4edda;
            color: #155724;
        }

        .zone-cardio {
            background: #fff3cd;
            color: #856404;
        }

        .zone-peak {
            background: #f8d7da;
            color: #721c24;
        }

        .progress-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .progress-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .progress-item:last-child {
            margin-bottom: 0;
        }

        .progress-label {
            font-size: 16px;
            color: #2c3e50;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            margin: 0 15px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #2ECC71;
            transition: width 0.3s ease;
        }

        .progress-value {
            font-size: 16px;
            font-weight: 600;
            color: #2ECC71;
            min-width: 60px;
            text-align: right;
        }

        .action-buttons {
            margin-top: auto;
            display: flex;
            gap: 10px;
        }

        .action-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.9);
            color: #495057;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 1);
        }

        .btn-primary {
            background: #2ECC71;
            color: white;
        }

        .btn-primary:hover {
            background: #27ae60;
        }

        .sensor-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .status-connected {
            background: #2ECC71;
        }

        .status-disconnected {
            background: #e74c3c;
        }

        @media (max-width: 600px) {
            .workout-container {
                padding: 15px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .timer-display {
                font-size: 36px;
            }

            .heart-rate-value {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
    <div class="workout-container">
        <!-- ‰º†ÊÑüÂô®Áä∂ÊÄÅÊåáÁ§∫Âô® -->
        <div class="sensor-status" id="sensorStatus">
            <span class="status-indicator status-disconnected" id="statusIndicator"></span>
            <span id="statusText">‰º†ÊÑüÂô®Êú™ËøûÊé•</span>
        </div>

        <!-- Â§¥ÈÉ®‰ø°ÊÅØ -->
        <div class="header">
            <h1>ËøêÂä®ËøΩË∏™</h1>
            <div class="workout-type" id="workoutType">Âø´Ëµ∞</div>
        </div>

        <!-- ËÆ°Êó∂Âô®Âå∫Âüü -->
        <div class="timer-section">
            <div class="timer-display" id="timerDisplay">00:00:00</div>
            <div class="timer-status" id="timerStatus">ÂáÜÂ§áÂºÄÂßã</div>
            <div class="control-buttons">
                <button class="control-btn btn-start" id="startBtn" onclick="startWorkout()">ÂºÄÂßã</button>
                <button class="control-btn btn-pause" id="pauseBtn" onclick="pauseWorkout()" style="display: none;">ÊöÇÂÅú</button>
                <button class="control-btn btn-stop" id="stopBtn" onclick="stopWorkout()" style="display: none;">ÁªìÊùü</button>
            </div>
        </div>

        <!-- ÂøÉÁéáÁõëÊµã -->
        <div class="heart-rate-card">
            <div class="heart-rate-display">
                <span class="heart-icon">üíì</span>
                <span class="heart-rate-value" id="heartRate">--</span>
                <span class="heart-rate-unit">BPM</span>
            </div>
            <div class="heart-rate-zone zone-fat-burn" id="heartRateZone">ÂæÖÊ£ÄÊµã</div>
        </div>

        <!-- ÁªüËÆ°Êï∞ÊçÆ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üö∂</div>
                <div class="stat-value" id="stepCount">0</div>
                <div class="stat-label">Ê≠•Êï∞</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üî•</div>
                <div class="stat-value" id="caloriesBurned">0</div>
                <div class="stat-label">Âç°Ë∑ØÈáå</div>
            </div>
        </div>

        <!-- ËøõÂ∫¶ÊåáÊ†á -->
        <div class="progress-section">
            <div class="progress-item">
                <span class="progress-label">ÁõÆÊ†áÊó∂Èó¥</span>
                <div class="progress-bar">
                    <div class="progress-fill" id="timeProgress" style="width: 0%"></div>
                </div>
                <span class="progress-value" id="timeProgressText">0%</span>
            </div>
            <div class="progress-item">
                <span class="progress-label">ÁõÆÊ†áÁÉ≠Èáè</span>
                <div class="progress-bar">
                    <div class="progress-fill" id="calorieProgress" style="width: 0%"></div>
                </div>
                <span class="progress-value" id="calorieProgressText">0%</span>
            </div>
        </div>

        <!-- Êìç‰ΩúÊåâÈíÆ -->
        <div class="action-buttons">
            <button class="action-btn btn-secondary" onclick="goBack()">ËøîÂõû</button>
            <button class="action-btn btn-primary" onclick="saveWorkout()" id="saveBtn" style="display: none;">‰øùÂ≠òËÆ∞ÂΩï</button>
        </div>
    </div>

    <script>
        // ËøêÂä®Áä∂ÊÄÅÁÆ°ÁêÜ
        let workoutState = {
            isActive: false,
            isPaused: false,
            startTime: null,
            pausedTime: 0,
            elapsedTime: 0,
            heartRate: 0,
            stepCount: 0,
            initialSteps: 0,
            caloriesBurned: 0,
            targetDuration: 30 * 60, // 30ÂàÜÈíüÔºàÁßíÔºâ
            targetCalories: 200,
            workoutType: 'Âø´Ëµ∞'
        };

        // ÂÆöÊó∂Âô®
        let workoutTimer = null;
        let heartRateTimer = null;
        let stepCountTimer = null;

        // Áî®Êà∑Êï∞ÊçÆ
        let userData = {};

        // È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // Ëé∑Âèñ‰º†ÈÄíÁöÑËøêÂä®Á±ªÂûãÂíåÁî®Êà∑Êï∞ÊçÆ
            const urlParams = new URLSearchParams(window.location.search);
            const exerciseType = urlParams.get('exercise') || 'Âø´Ëµ∞';
            workoutState.workoutType = exerciseType;
            document.getElementById('workoutType').textContent = exerciseType;

            // Ëé∑ÂèñÁî®Êà∑Êï∞ÊçÆ
            userData = JSON.parse(localStorage.getItem('userData') || '{}');

            // Ê†πÊçÆËøêÂä®Á±ªÂûãËÆæÁΩÆÁõÆÊ†á
            setExerciseTargets(exerciseType);

            // ËØ∑Ê±Ç‰º†ÊÑüÂô®ÊùÉÈôê
            requestSensorPermissions();

            // Ê®°Êãü‰º†ÊÑüÂô®Êï∞ÊçÆÔºàÁî®‰∫éÊºîÁ§∫Ôºâ
            startSensorSimulation();
        });

        // ËÆæÁΩÆËøêÂä®ÁõÆÊ†á
        function setExerciseTargets(exerciseType) {
            const targets = {
                'Âø´Ëµ∞': { duration: 30 * 60, calories: 150 },
                'ÊÖ¢Ë∑ë': { duration: 25 * 60, calories: 250 },
                'Ê∏∏Ê≥≥': { duration: 40 * 60, calories: 300 },
                'Ë∑≥Áª≥': { duration: 15 * 60, calories: 200 },
                'ÂæíÊâãÊ∑±Ëπ≤': { duration: 15 * 60, calories: 80 },
                '‰øØÂçßÊíë': { duration: 12 * 60, calories: 70 },
                'Áëú‰ºΩ': { duration: 30 * 60, calories: 120 }
            };

            const target = targets[exerciseType] || targets['Âø´Ëµ∞'];
            workoutState.targetDuration = target.duration;
            workoutState.targetCalories = target.calories;
        }

        // ËØ∑Ê±Ç‰º†ÊÑüÂô®ÊùÉÈôê
        async function requestSensorPermissions() {
            try {
                // Ê£ÄÊü•ËÆæÂ§áËøêÂä®‰º†ÊÑüÂô®ÊîØÊåÅ
                if ('DeviceMotionEvent' in window) {
                    // ÂØπ‰∫éiOS 13+ÔºåÈúÄË¶ÅËØ∑Ê±ÇÊùÉÈôê
                    if (typeof DeviceMotionEvent.requestPermission === 'function') {
                        const permission = await DeviceMotionEvent.requestPermission();
                        if (permission === 'granted') {
                            enableSensors();
                        }
                    } else {
                        enableSensors();
                    }
                }

                // Ê£ÄÊü•ÂøÉÁéá‰º†ÊÑüÂô®ÔºàWeb BluetoothÔºâ
                if ('bluetooth' in navigator) {
                    updateSensorStatus(true, '‰º†ÊÑüÂô®Â∑≤ËøûÊé•');
                } else {
                    updateSensorStatus(false, '‰º†ÊÑüÂô®Êú™ËøûÊé•');
                }
            } catch (error) {
                console.error('‰º†ÊÑüÂô®ÊùÉÈôêËØ∑Ê±ÇÂ§±Ë¥•:', error);
                updateSensorStatus(false, '‰º†ÊÑüÂô®ÊùÉÈôêË¢´ÊãíÁªù');
            }
        }

        // ÂêØÁî®‰º†ÊÑüÂô®
        function enableSensors() {
            // ÁõëÂê¨ËÆæÂ§áËøêÂä®ÔºàÁî®‰∫éÊ≠•Êï∞ËÆ°ÁÆóÔºâ
            if (window.DeviceMotionEvent) {
                window.addEventListener('devicemotion', handleDeviceMotion);
            }

            updateSensorStatus(true, '‰º†ÊÑüÂô®Â∑≤ËøûÊé•');
        }

        // Â§ÑÁêÜËÆæÂ§áËøêÂä®Êï∞ÊçÆ
        function handleDeviceMotion(event) {
            if (!workoutState.isActive) return;

            const acceleration = event.acceleration;
            if (acceleration) {
                // ÁÆÄÂåñÁöÑÊ≠•Êï∞Ê£ÄÊµãÁÆóÊ≥ï
                const magnitude = Math.sqrt(
                    acceleration.x * acceleration.x +
                    acceleration.y * acceleration.y +
                    acceleration.z * acceleration.z
                );

                // Ê£ÄÊµãÊ≠•‰ºêÔºàÁÆÄÂåñÁâàÊú¨Ôºâ
                if (magnitude > 2.5) {
                    workoutState.stepCount++;
                    updateDisplay();
                }
            }
        }

        // ÂºÄÂßãËøêÂä®
        function startWorkout() {
            if (!workoutState.isActive) {
                workoutState.isActive = true;
                workoutState.isPaused = false;
                workoutState.startTime = Date.now() - workoutState.pausedTime;
                workoutState.initialSteps = workoutState.stepCount;

                // Êõ¥Êñ∞UI
                document.getElementById('startBtn').style.display = 'none';
                document.getElementById('pauseBtn').style.display = 'inline-block';
                document.getElementById('stopBtn').style.display = 'inline-block';
                document.getElementById('timerStatus').textContent = 'ËøêÂä®‰∏≠';

                // ÂêØÂä®ÂÆöÊó∂Âô®
                startTimers();
            }
        }

        // ÊöÇÂÅúËøêÂä®
        function pauseWorkout() {
            if (workoutState.isActive && !workoutState.isPaused) {
                workoutState.isPaused = true;
                workoutState.pausedTime = Date.now() - workoutState.startTime;

                // Êõ¥Êñ∞UI
                document.getElementById('pauseBtn').textContent = 'ÁªßÁª≠';
                document.getElementById('pauseBtn').onclick = resumeWorkout;
                document.getElementById('timerStatus').textContent = 'Â∑≤ÊöÇÂÅú';

                // ÂÅúÊ≠¢ÂÆöÊó∂Âô®
                stopTimers();
            }
        }

        // ÁªßÁª≠ËøêÂä®
        function resumeWorkout() {
            if (workoutState.isActive && workoutState.isPaused) {
                workoutState.isPaused = false;
                workoutState.startTime = Date.now() - workoutState.pausedTime;

                // Êõ¥Êñ∞UI
                document.getElementById('pauseBtn').textContent = 'ÊöÇÂÅú';
                document.getElementById('pauseBtn').onclick = pauseWorkout;
                document.getElementById('timerStatus').textContent = 'ËøêÂä®‰∏≠';

                // ÈáçÂêØÂÆöÊó∂Âô®
                startTimers();
            }
        }

        // ÁªìÊùüËøêÂä®
        function stopWorkout() {
            workoutState.isActive = false;
            workoutState.isPaused = false;

            // Êõ¥Êñ∞UI
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('startBtn').textContent = 'ÈáçÊñ∞ÂºÄÂßã';
            document.getElementById('pauseBtn').style.display = 'none';
            document.getElementById('stopBtn').style.display = 'none';
            document.getElementById('saveBtn').style.display = 'inline-block';
            document.getElementById('timerStatus').textContent = 'ËøêÂä®Â∑≤ÁªìÊùü';

            // ÂÅúÊ≠¢ÂÆöÊó∂Âô®
            stopTimers();

            // ÊòæÁ§∫ËøêÂä®ÊÄªÁªì
            showWorkoutSummary();
        }

        // ÂêØÂä®ÂÆöÊó∂Âô®
        function startTimers() {
            workoutTimer = setInterval(updateTimer, 1000);
            heartRateTimer = setInterval(updateHeartRate, 2000);
            stepCountTimer = setInterval(updateStepCount, 500);
        }

        // ÂÅúÊ≠¢ÂÆöÊó∂Âô®
        function stopTimers() {
            if (workoutTimer) {
                clearInterval(workoutTimer);
                workoutTimer = null;
            }
            if (heartRateTimer) {
                clearInterval(heartRateTimer);
                heartRateTimer = null;
            }
            if (stepCountTimer) {
                clearInterval(stepCountTimer);
                stepCountTimer = null;
            }
        }

        // Êõ¥Êñ∞ËÆ°Êó∂Âô®
        function updateTimer() {
            if (!workoutState.isActive || workoutState.isPaused) return;

            workoutState.elapsedTime = Date.now() - workoutState.startTime;
            const seconds = Math.floor(workoutState.elapsedTime / 1000);

            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;

            const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            document.getElementById('timerDisplay').textContent = timeString;

            // Êõ¥Êñ∞ËøõÂ∫¶
            updateProgress();
        }

        // Ê®°ÊãüÂøÉÁéáÊõ¥Êñ∞
        function updateHeartRate() {
            if (!workoutState.isActive) return;

            // Ê®°ÊãüÂøÉÁéáÊï∞ÊçÆÔºàÂü∫‰∫éËøêÂä®Á±ªÂûãÂíåÊó∂Èó¥Ôºâ
            const baseHR = getBaseHeartRate();
            const variation = Math.random() * 10 - 5; // ¬±5ÁöÑÈöèÊú∫ÂèòÂåñ
            workoutState.heartRate = Math.round(baseHR + variation);

            document.getElementById('heartRate').textContent = workoutState.heartRate;

            // Êõ¥Êñ∞ÂøÉÁéáÂå∫Èó¥
            updateHeartRateZone(workoutState.heartRate);
        }

        // Ëé∑ÂèñÂü∫Á°ÄÂøÉÁéá
        function getBaseHeartRate() {
            const age = userData.age || 30;
            const maxHR = 220 - age;

            const hrZones = {
                'Âø´Ëµ∞': maxHR * 0.6,
                'ÊÖ¢Ë∑ë': maxHR * 0.75,
                'Ê∏∏Ê≥≥': maxHR * 0.7,
                'Ë∑≥Áª≥': maxHR * 0.8,
                'ÂæíÊâãÊ∑±Ëπ≤': maxHR * 0.65,
                '‰øØÂçßÊíë': maxHR * 0.65,
                'Áëú‰ºΩ': maxHR * 0.5
            };

            return hrZones[workoutState.workoutType] || maxHR * 0.6;
        }

        // Êõ¥Êñ∞ÂøÉÁéáÂå∫Èó¥
        function updateHeartRateZone(heartRate) {
            const age = userData.age || 30;
            const maxHR = 220 - age;

            let zone = 'zone-fat-burn';
            let zoneName = 'ÁáÉËÑÇÂå∫Èó¥';

            if (heartRate > maxHR * 0.85) {
                zone = 'zone-peak';
                zoneName = 'Êó†Ê∞ßÂå∫Èó¥';
            } else if (heartRate > maxHR * 0.7) {
                zone = 'zone-cardio';
                zoneName = 'ÊúâÊ∞ßÂå∫Èó¥';
            }

            const zoneElement = document.getElementById('heartRateZone');
            zoneElement.className = `heart-rate-zone ${zone}`;
            zoneElement.textContent = zoneName;
        }

        // Êõ¥Êñ∞Ê≠•Êï∞
        function updateStepCount() {
            if (!workoutState.isActive) return;

            // Âü∫‰∫éËøêÂä®Á±ªÂûãÊ®°ÊãüÊ≠•Êï∞Â¢ûÈïø
            const stepsPerSecond = getStepsPerSecond();
            workoutState.stepCount += stepsPerSecond * 0.5; // ÊØè500msË∞ÉÁî®‰∏ÄÊ¨°

            updateDisplay();
        }

        // Ëé∑ÂèñÊØèÁßíÊ≠•Êï∞
        function getStepsPerSecond() {
            const stepsRates = {
                'Âø´Ëµ∞': 1.5,
                'ÊÖ¢Ë∑ë': 2.5,
                'Ê∏∏Ê≥≥': 0,
                'Ë∑≥Áª≥': 3.0,
                'ÂæíÊâãÊ∑±Ëπ≤': 0.5,
                '‰øØÂçßÊíë': 0,
                'Áëú‰ºΩ': 0.2
            };

            return stepsRates[workoutState.workoutType] || 1.5;
        }

        // ËÆ°ÁÆóÁÉ≠ÈáèÊ∂àËÄó
        function calculateCalories() {
            if (!workoutState.elapsedTime) return 0;

            const minutes = workoutState.elapsedTime / (1000 * 60);
            const weight = userData.weight || 70; // ÈªòËÆ§70kg

            // METÂÄºÔºà‰ª£Ë∞¢ÂΩìÈáèÔºâ
            const metValues = {
                'Âø´Ëµ∞': 3.5,
                'ÊÖ¢Ë∑ë': 7.0,
                'Ê∏∏Ê≥≥': 8.0,
                'Ë∑≥Áª≥': 10.0,
                'ÂæíÊâãÊ∑±Ëπ≤': 5.0,
                '‰øØÂçßÊíë': 6.0,
                'Áëú‰ºΩ': 2.5
            };

            const met = metValues[workoutState.workoutType] || 3.5;

            // ÁÉ≠ÈáèËÆ°ÁÆóÂÖ¨Âºè: MET √ó ‰ΩìÈáç(kg) √ó Êó∂Èó¥(Â∞èÊó∂)
            const calories = met * weight * (minutes / 60);
            return Math.round(calories);
        }

        // Êõ¥Êñ∞ÊòæÁ§∫
        function updateDisplay() {
            document.getElementById('stepCount').textContent = Math.round(workoutState.stepCount);

            workoutState.caloriesBurned = calculateCalories();
            document.getElementById('caloriesBurned').textContent = workoutState.caloriesBurned;
        }

        // Êõ¥Êñ∞ËøõÂ∫¶
        function updateProgress() {
            const timeProgress = Math.min((workoutState.elapsedTime / 1000) / workoutState.targetDuration * 100, 100);
            const calorieProgress = Math.min(workoutState.caloriesBurned / workoutState.targetCalories * 100, 100);

            document.getElementById('timeProgress').style.width = timeProgress + '%';
            document.getElementById('timeProgressText').textContent = Math.round(timeProgress) + '%';

            document.getElementById('calorieProgress').style.width = calorieProgress + '%';
            document.getElementById('calorieProgressText').textContent = Math.round(calorieProgress) + '%';
        }

        // Êõ¥Êñ∞‰º†ÊÑüÂô®Áä∂ÊÄÅ
        function updateSensorStatus(connected, message) {
            const indicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');

            if (connected) {
                indicator.className = 'status-indicator status-connected';
                statusText.textContent = message;
            } else {
                indicator.className = 'status-indicator status-disconnected';
                statusText.textContent = message;
            }
        }

        // ÂêØÂä®‰º†ÊÑüÂô®Ê®°ÊãüÔºàÁî®‰∫éÊºîÁ§∫Ôºâ
        function startSensorSimulation() {
            updateSensorStatus(true, 'Ê®°Êãü‰º†ÊÑüÂô®Â∑≤ËøûÊé•');
        }

        // ÊòæÁ§∫ËøêÂä®ÊÄªÁªì
        function showWorkoutSummary() {
            const duration = Math.floor(workoutState.elapsedTime / 1000);
            const minutes = Math.floor(duration / 60);
            const seconds = duration % 60;

            const summary = `ËøêÂä®ÊÄªÁªìÔºö
Êó∂ÈïøÔºö${minutes}ÂàÜ${seconds}Áßí
Ê≠•Êï∞Ôºö${Math.round(workoutState.stepCount)}Ê≠•
ÁÉ≠ÈáèÔºö${workoutState.caloriesBurned}Âç°Ë∑ØÈáå
Âπ≥ÂùáÂøÉÁéáÔºö${workoutState.heartRate}BPM`;

            alert(summary);
        }

        // ‰øùÂ≠òËøêÂä®ËÆ∞ÂΩï
        function saveWorkout() {
            const workoutRecord = {
                date: new Date().toISOString(),
                type: workoutState.workoutType,
                duration: workoutState.elapsedTime,
                steps: Math.round(workoutState.stepCount),
                calories: workoutState.caloriesBurned,
                avgHeartRate: workoutState.heartRate
            };

            // Ëé∑ÂèñÁé∞ÊúâËÆ∞ÂΩï
            const workoutHistory = JSON.parse(localStorage.getItem('workoutHistory') || '[]');
            workoutHistory.push(workoutRecord);

            // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
            localStorage.setItem('workoutHistory', JSON.stringify(workoutHistory));

            alert('ËøêÂä®ËÆ∞ÂΩïÂ∑≤‰øùÂ≠òÔºÅ');

            // ËøîÂõûËøêÂä®Êé®ËçêÈ°µÈù¢
            window.location.href = 'exercise.html';
        }

        // ËøîÂõû‰∏ä‰∏ÄÈ°µ
        function goBack() {
            if (workoutState.isActive) {
                const confirm = window.confirm('ËøêÂä®Ê≠£Âú®ËøõË°å‰∏≠ÔºåÁ°ÆÂÆöË¶ÅÈÄÄÂá∫ÂêóÔºü');
                if (!confirm) return;
            }

            window.location.href = 'exercise.html';
        }

        // È°µÈù¢Âç∏ËΩΩÊó∂Ê∏ÖÁêÜ
        window.addEventListener('beforeunload', function() {
            stopTimers();
        });
    </script>
</body>
</html>