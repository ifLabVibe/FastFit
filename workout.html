<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¿åŠ¨è¿½è¸ª - å®æ—¶è®°å½•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 0;
        }

        .workout-container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .workout-type {
            font-size: 18px;
            opacity: 0.9;
        }

        .timer-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .timer-display {
            font-size: 48px;
            font-weight: bold;
            color: #2ECC71;
            margin-bottom: 10px;
            font-variant-numeric: tabular-nums;
        }

        .timer-status {
            font-size: 16px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        .control-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .control-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        .btn-start {
            background: #2ECC71;
            color: white;
        }

        .btn-start:hover {
            background: #27ae60;
        }

        .btn-pause {
            background: #f39c12;
            color: white;
        }

        .btn-pause:hover {
            background: #e67e22;
        }

        .btn-stop {
            background: #e74c3c;
            color: white;
        }

        .btn-stop:hover {
            background: #c0392b;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .stat-icon {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2ECC71;
            margin-bottom: 5px;
            font-variant-numeric: tabular-nums;
        }

        .stat-label {
            font-size: 14px;
            color: #7f8c8d;
        }

        .heart-rate-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .heart-rate-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .heart-icon {
            font-size: 32px;
            color: #e74c3c;
            animation: heartbeat 1.5s ease-in-out infinite;
        }

        @keyframes heartbeat {
            0% { transform: scale(1); }
            25% { transform: scale(1.1); }
            50% { transform: scale(1); }
            75% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .heart-rate-value {
            font-size: 36px;
            font-weight: bold;
            color: #e74c3c;
            font-variant-numeric: tabular-nums;
        }

        .heart-rate-unit {
            font-size: 14px;
            color: #7f8c8d;
            margin-left: 5px;
        }

        .heart-rate-zone {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .zone-fat-burn {
            background: #d4edda;
            color: #155724;
        }

        .zone-cardio {
            background: #fff3cd;
            color: #856404;
        }

        .zone-peak {
            background: #f8d7da;
            color: #721c24;
        }

        .progress-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .progress-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .progress-item:last-child {
            margin-bottom: 0;
        }

        .progress-label {
            font-size: 16px;
            color: #2c3e50;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            margin: 0 15px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #2ECC71;
            transition: width 0.3s ease;
        }

        .progress-value {
            font-size: 16px;
            font-weight: 600;
            color: #2ECC71;
            min-width: 60px;
            text-align: right;
        }

        .action-buttons {
            margin-top: auto;
            display: flex;
            gap: 10px;
        }

        .action-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.9);
            color: #495057;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 1);
        }

        .btn-primary {
            background: #2ECC71;
            color: white;
        }

        .btn-primary:hover {
            background: #27ae60;
        }

        .sensor-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .status-connected {
            background: #2ECC71;
        }

        .status-disconnected {
            background: #e74c3c;
        }

        @media (max-width: 600px) {
            .workout-container {
                padding: 15px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .timer-display {
                font-size: 36px;
            }

            .heart-rate-value {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
    <div class="workout-container">
        <!-- ä¼ æ„Ÿå™¨çŠ¶æ€æŒ‡ç¤ºå™¨ -->
        <div class="sensor-status" id="sensorStatus">
            <span class="status-indicator status-disconnected" id="statusIndicator"></span>
            <span id="statusText">ä¼ æ„Ÿå™¨æœªè¿æ¥</span>
        </div>

        <!-- å¤´éƒ¨ä¿¡æ¯ -->
        <div class="header">
            <h1>è¿åŠ¨è¿½è¸ª</h1>
            <div class="workout-type" id="workoutType">å¿«èµ°</div>
        </div>

        <!-- è®¡æ—¶å™¨åŒºåŸŸ -->
        <div class="timer-section">
            <div class="timer-display" id="timerDisplay">00:00:00</div>
            <div class="timer-status" id="timerStatus">å‡†å¤‡å¼€å§‹</div>
            <div class="control-buttons">
                <button class="control-btn btn-start" id="startBtn" onclick="startWorkout()">å¼€å§‹</button>
                <button class="control-btn btn-pause" id="pauseBtn" onclick="pauseWorkout()" style="display: none;">æš‚åœ</button>
                <button class="control-btn btn-stop" id="stopBtn" onclick="stopWorkout()" style="display: none;">ç»“æŸ</button>
            </div>
        </div>

        <!-- å¿ƒç‡ç›‘æµ‹ -->
        <div class="heart-rate-card">
            <div class="heart-rate-display">
                <span class="heart-icon">ğŸ’“</span>
                <span class="heart-rate-value" id="heartRate">--</span>
                <span class="heart-rate-unit">BPM</span>
            </div>
            <div class="heart-rate-zone zone-fat-burn" id="heartRateZone">å¾…æ£€æµ‹</div>
        </div>

        <!-- ç»Ÿè®¡æ•°æ® -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">ğŸš¶</div>
                <div class="stat-value" id="stepCount">0</div>
                <div class="stat-label">æ­¥æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ”¥</div>
                <div class="stat-value" id="caloriesBurned">0</div>
                <div class="stat-label">å¡è·¯é‡Œ</div>
            </div>
        </div>

        <!-- è¿›åº¦æŒ‡æ ‡ -->
        <div class="progress-section">
            <div class="progress-item">
                <span class="progress-label">ç›®æ ‡æ—¶é—´</span>
                <div class="progress-bar">
                    <div class="progress-fill" id="timeProgress" style="width: 0%"></div>
                </div>
                <span class="progress-value" id="timeProgressText">0%</span>
            </div>
            <div class="progress-item">
                <span class="progress-label">ç›®æ ‡çƒ­é‡</span>
                <div class="progress-bar">
                    <div class="progress-fill" id="calorieProgress" style="width: 0%"></div>
                </div>
                <span class="progress-value" id="calorieProgressText">0%</span>
            </div>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="action-buttons">
            <button class="action-btn btn-secondary" onclick="goBack()">è¿”å›</button>
            <button class="action-btn btn-primary" onclick="saveWorkout()" id="saveBtn" style="display: none;">ä¿å­˜è®°å½•</button>
        </div>
    </div>

    <script>
        // è¿åŠ¨çŠ¶æ€ç®¡ç†
        let workoutState = {
            isActive: false,
            isPaused: false,
            startTime: null,
            pausedTime: 0,
            elapsedTime: 0,
            heartRate: 0,
            stepCount: 0,
            initialSteps: 0,
            caloriesBurned: 0,
            targetDuration: 30 * 60, // 30åˆ†é’Ÿï¼ˆç§’ï¼‰
            targetCalories: 200,
            workoutType: 'å¿«èµ°'
        };

        // å®šæ—¶å™¨
        let workoutTimer = null;
        let heartRateTimer = null;
        let stepCountTimer = null;

        // ç”¨æˆ·æ•°æ®
        let userData = {};

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // è·å–ä¼ é€’çš„è¿åŠ¨ç±»å‹å’Œç”¨æˆ·æ•°æ®
            const urlParams = new URLSearchParams(window.location.search);
            const exerciseType = urlParams.get('exercise') || 'å¿«èµ°';
            workoutState.workoutType = exerciseType;
            document.getElementById('workoutType').textContent = exerciseType;

            // è·å–ç”¨æˆ·æ•°æ®
            userData = JSON.parse(localStorage.getItem('userData') || '{}');

            // æ ¹æ®è¿åŠ¨ç±»å‹è®¾ç½®ç›®æ ‡
            setExerciseTargets(exerciseType);

            // è¯·æ±‚ä¼ æ„Ÿå™¨æƒé™
            requestSensorPermissions();

            // æ¨¡æ‹Ÿä¼ æ„Ÿå™¨æ•°æ®ï¼ˆç”¨äºæ¼”ç¤ºï¼‰
            startSensorSimulation();
        });

        // è®¾ç½®è¿åŠ¨ç›®æ ‡
        function setExerciseTargets(exerciseType) {
            const targets = {
                'å¿«èµ°': { duration: 30 * 60, calories: 150 },
                'æ…¢è·‘': { duration: 25 * 60, calories: 250 },
                'æ¸¸æ³³': { duration: 40 * 60, calories: 300 },
                'è·³ç»³': { duration: 15 * 60, calories: 200 },
                'å¾’æ‰‹æ·±è¹²': { duration: 15 * 60, calories: 80 },
                'ä¿¯å§æ’‘': { duration: 12 * 60, calories: 70 },
                'ç‘œä¼½': { duration: 30 * 60, calories: 120 }
            };

            const target = targets[exerciseType] || targets['å¿«èµ°'];
            workoutState.targetDuration = target.duration;
            workoutState.targetCalories = target.calories;
        }

        // è¯·æ±‚ä¼ æ„Ÿå™¨æƒé™
        async function requestSensorPermissions() {
            try {
                // æ£€æŸ¥è®¾å¤‡è¿åŠ¨ä¼ æ„Ÿå™¨æ”¯æŒ
                if ('DeviceMotionEvent' in window) {
                    // å¯¹äºiOS 13+ï¼Œéœ€è¦è¯·æ±‚æƒé™
                    if (typeof DeviceMotionEvent.requestPermission === 'function') {
                        const permission = await DeviceMotionEvent.requestPermission();
                        if (permission === 'granted') {
                            enableSensors();
                        }
                    } else {
                        enableSensors();
                    }
                }

                // æ£€æŸ¥å¿ƒç‡ä¼ æ„Ÿå™¨ï¼ˆWeb Bluetoothï¼‰
                if ('bluetooth' in navigator) {
                    updateSensorStatus(true, 'ä¼ æ„Ÿå™¨å·²è¿æ¥');
                } else {
                    updateSensorStatus(false, 'ä¼ æ„Ÿå™¨æœªè¿æ¥');
                }
            } catch (error) {
                console.error('ä¼ æ„Ÿå™¨æƒé™è¯·æ±‚å¤±è´¥:', error);
                updateSensorStatus(false, 'ä¼ æ„Ÿå™¨æƒé™è¢«æ‹’ç»');
            }
        }

        // å¯ç”¨ä¼ æ„Ÿå™¨
        function enableSensors() {
            // ç›‘å¬è®¾å¤‡è¿åŠ¨ï¼ˆç”¨äºæ­¥æ•°è®¡ç®—ï¼‰
            if (window.DeviceMotionEvent) {
                window.addEventListener('devicemotion', handleDeviceMotion);
            }

            updateSensorStatus(true, 'ä¼ æ„Ÿå™¨å·²è¿æ¥');
        }

        // å¤„ç†è®¾å¤‡è¿åŠ¨æ•°æ®
        function handleDeviceMotion(event) {
            if (!workoutState.isActive) return;

            const acceleration = event.acceleration;
            if (acceleration) {
                // ç®€åŒ–çš„æ­¥æ•°æ£€æµ‹ç®—æ³•
                const magnitude = Math.sqrt(
                    acceleration.x * acceleration.x +
                    acceleration.y * acceleration.y +
                    acceleration.z * acceleration.z
                );

                // æ£€æµ‹æ­¥ä¼ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰
                if (magnitude > 2.5) {
                    workoutState.stepCount++;
                    updateDisplay();
                }
            }
        }

        // å¼€å§‹è¿åŠ¨
        function startWorkout() {
            if (!workoutState.isActive) {
                workoutState.isActive = true;
                workoutState.isPaused = false;
                workoutState.startTime = Date.now() - workoutState.pausedTime;
                workoutState.initialSteps = workoutState.stepCount;

                // æ›´æ–°UI
                document.getElementById('startBtn').style.display = 'none';
                document.getElementById('pauseBtn').style.display = 'inline-block';
                document.getElementById('stopBtn').style.display = 'inline-block';
                document.getElementById('timerStatus').textContent = 'è¿åŠ¨ä¸­';

                // å¯åŠ¨å®šæ—¶å™¨
                startTimers();
            }
        }

        // æš‚åœè¿åŠ¨
        function pauseWorkout() {
            if (workoutState.isActive && !workoutState.isPaused) {
                workoutState.isPaused = true;
                workoutState.pausedTime = Date.now() - workoutState.startTime;

                // æ›´æ–°UI
                document.getElementById('pauseBtn').textContent = 'ç»§ç»­';
                document.getElementById('pauseBtn').onclick = resumeWorkout;
                document.getElementById('timerStatus').textContent = 'å·²æš‚åœ';

                // åœæ­¢å®šæ—¶å™¨
                stopTimers();
            }
        }

        // ç»§ç»­è¿åŠ¨
        function resumeWorkout() {
            if (workoutState.isActive && workoutState.isPaused) {
                workoutState.isPaused = false;
                workoutState.startTime = Date.now() - workoutState.pausedTime;

                // æ›´æ–°UI
                document.getElementById('pauseBtn').textContent = 'æš‚åœ';
                document.getElementById('pauseBtn').onclick = pauseWorkout;
                document.getElementById('timerStatus').textContent = 'è¿åŠ¨ä¸­';

                // é‡å¯å®šæ—¶å™¨
                startTimers();
            }
        }

        // ç»“æŸè¿åŠ¨
        function stopWorkout() {
            workoutState.isActive = false;
            workoutState.isPaused = false;

            // æ›´æ–°UI
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('startBtn').textContent = 'é‡æ–°å¼€å§‹';
            document.getElementById('pauseBtn').style.display = 'none';
            document.getElementById('stopBtn').style.display = 'none';
            document.getElementById('saveBtn').style.display = 'inline-block';
            document.getElementById('timerStatus').textContent = 'è¿åŠ¨å·²ç»“æŸ';

            // åœæ­¢å®šæ—¶å™¨
            stopTimers();

            // æ˜¾ç¤ºè¿åŠ¨æ€»ç»“
            showWorkoutSummary();
        }

        // å¯åŠ¨å®šæ—¶å™¨
        function startTimers() {
            workoutTimer = setInterval(updateTimer, 1000);
            heartRateTimer = setInterval(updateHeartRate, 2000);
            stepCountTimer = setInterval(updateStepCount, 500);
        }

        // åœæ­¢å®šæ—¶å™¨
        function stopTimers() {
            if (workoutTimer) {
                clearInterval(workoutTimer);
                workoutTimer = null;
            }
            if (heartRateTimer) {
                clearInterval(heartRateTimer);
                heartRateTimer = null;
            }
            if (stepCountTimer) {
                clearInterval(stepCountTimer);
                stepCountTimer = null;
            }
        }

        // æ›´æ–°è®¡æ—¶å™¨
        function updateTimer() {
            if (!workoutState.isActive || workoutState.isPaused) return;

            workoutState.elapsedTime = Date.now() - workoutState.startTime;
            const seconds = Math.floor(workoutState.elapsedTime / 1000);

            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;

            const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            document.getElementById('timerDisplay').textContent = timeString;

            // æ›´æ–°è¿›åº¦
            updateProgress();
        }

        // æ¨¡æ‹Ÿå¿ƒç‡æ›´æ–°
        function updateHeartRate() {
            if (!workoutState.isActive) return;

            // æ¨¡æ‹Ÿå¿ƒç‡æ•°æ®ï¼ˆåŸºäºè¿åŠ¨ç±»å‹å’Œæ—¶é—´ï¼‰
            const baseHR = getBaseHeartRate();
            const variation = Math.random() * 10 - 5; // Â±5çš„éšæœºå˜åŒ–
            workoutState.heartRate = Math.round(baseHR + variation);

            document.getElementById('heartRate').textContent = workoutState.heartRate;

            // æ›´æ–°å¿ƒç‡åŒºé—´
            updateHeartRateZone(workoutState.heartRate);
        }

        // è·å–åŸºç¡€å¿ƒç‡
        function getBaseHeartRate() {
            const age = userData.age || 30;
            const maxHR = 220 - age;

            const hrZones = {
                'å¿«èµ°': maxHR * 0.6,
                'æ…¢è·‘': maxHR * 0.75,
                'æ¸¸æ³³': maxHR * 0.7,
                'è·³ç»³': maxHR * 0.8,
                'å¾’æ‰‹æ·±è¹²': maxHR * 0.65,
                'ä¿¯å§æ’‘': maxHR * 0.65,
                'ç‘œä¼½': maxHR * 0.5
            };

            return hrZones[workoutState.workoutType] || maxHR * 0.6;
        }

        // æ›´æ–°å¿ƒç‡åŒºé—´
        function updateHeartRateZone(heartRate) {
            const age = userData.age || 30;
            const maxHR = 220 - age;

            let zone = 'zone-fat-burn';
            let zoneName = 'ç‡ƒè„‚åŒºé—´';

            if (heartRate > maxHR * 0.85) {
                zone = 'zone-peak';
                zoneName = 'æ— æ°§åŒºé—´';
            } else if (heartRate > maxHR * 0.7) {
                zone = 'zone-cardio';
                zoneName = 'æœ‰æ°§åŒºé—´';
            }

            const zoneElement = document.getElementById('heartRateZone');
            zoneElement.className = `heart-rate-zone ${zone}`;
            zoneElement.textContent = zoneName;
        }

        // æ›´æ–°æ­¥æ•°
        function updateStepCount() {
            if (!workoutState.isActive) return;

            // åŸºäºè¿åŠ¨ç±»å‹æ¨¡æ‹Ÿæ­¥æ•°å¢é•¿
            const stepsPerSecond = getStepsPerSecond();
            workoutState.stepCount += stepsPerSecond * 0.5; // æ¯500msè°ƒç”¨ä¸€æ¬¡

            updateDisplay();
        }

        // è·å–æ¯ç§’æ­¥æ•°
        function getStepsPerSecond() {
            const stepsRates = {
                'å¿«èµ°': 1.5,
                'æ…¢è·‘': 2.5,
                'æ¸¸æ³³': 0,
                'è·³ç»³': 3.0,
                'å¾’æ‰‹æ·±è¹²': 0.5,
                'ä¿¯å§æ’‘': 0,
                'ç‘œä¼½': 0.2
            };

            return stepsRates[workoutState.workoutType] || 1.5;
        }

        // è®¡ç®—çƒ­é‡æ¶ˆè€—
        function calculateCalories() {
            if (!workoutState.elapsedTime) return 0;

            const minutes = workoutState.elapsedTime / (1000 * 60);
            const weight = userData.weight || 70; // é»˜è®¤70kg

            // METå€¼ï¼ˆä»£è°¢å½“é‡ï¼‰
            const metValues = {
                'å¿«èµ°': 3.5,
                'æ…¢è·‘': 7.0,
                'æ¸¸æ³³': 8.0,
                'è·³ç»³': 10.0,
                'å¾’æ‰‹æ·±è¹²': 5.0,
                'ä¿¯å§æ’‘': 6.0,
                'ç‘œä¼½': 2.5
            };

            const met = metValues[workoutState.workoutType] || 3.5;

            // çƒ­é‡è®¡ç®—å…¬å¼: MET Ã— ä½“é‡(kg) Ã— æ—¶é—´(å°æ—¶)
            const calories = met * weight * (minutes / 60);
            return Math.round(calories);
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            document.getElementById('stepCount').textContent = Math.round(workoutState.stepCount);

            workoutState.caloriesBurned = calculateCalories();
            document.getElementById('caloriesBurned').textContent = workoutState.caloriesBurned;
        }

        // æ›´æ–°è¿›åº¦
        function updateProgress() {
            const timeProgress = Math.min((workoutState.elapsedTime / 1000) / workoutState.targetDuration * 100, 100);
            const calorieProgress = Math.min(workoutState.caloriesBurned / workoutState.targetCalories * 100, 100);

            document.getElementById('timeProgress').style.width = timeProgress + '%';
            document.getElementById('timeProgressText').textContent = Math.round(timeProgress) + '%';

            document.getElementById('calorieProgress').style.width = calorieProgress + '%';
            document.getElementById('calorieProgressText').textContent = Math.round(calorieProgress) + '%';
        }

        // æ›´æ–°ä¼ æ„Ÿå™¨çŠ¶æ€
        function updateSensorStatus(connected, message) {
            const indicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');

            if (connected) {
                indicator.className = 'status-indicator status-connected';
                statusText.textContent = message;
            } else {
                indicator.className = 'status-indicator status-disconnected';
                statusText.textContent = message;
            }
        }

        // å¯åŠ¨ä¼ æ„Ÿå™¨æ¨¡æ‹Ÿï¼ˆç”¨äºæ¼”ç¤ºï¼‰
        function startSensorSimulation() {
            updateSensorStatus(true, 'æ¨¡æ‹Ÿä¼ æ„Ÿå™¨å·²è¿æ¥');
        }

        // æ˜¾ç¤ºè¿åŠ¨æ€»ç»“
        function showWorkoutSummary() {
            const duration = Math.floor(workoutState.elapsedTime / 1000);
            const minutes = Math.floor(duration / 60);
            const seconds = duration % 60;

            const summary = `è¿åŠ¨æ€»ç»“ï¼š
æ—¶é•¿ï¼š${minutes}åˆ†${seconds}ç§’
æ­¥æ•°ï¼š${Math.round(workoutState.stepCount)}æ­¥
çƒ­é‡ï¼š${workoutState.caloriesBurned}å¡è·¯é‡Œ
å¹³å‡å¿ƒç‡ï¼š${workoutState.heartRate}BPM`;

            alert(summary);
        }

        // ä¿å­˜è¿åŠ¨è®°å½•
        function saveWorkout() {
            const workoutRecord = {
                date: new Date().toISOString(),
                type: workoutState.workoutType,
                duration: workoutState.elapsedTime,
                steps: Math.round(workoutState.stepCount),
                calories: workoutState.caloriesBurned,
                avgHeartRate: workoutState.heartRate
            };

            // è·å–ç°æœ‰è®°å½•
            const workoutHistory = JSON.parse(localStorage.getItem('workoutHistory') || '[]');
            workoutHistory.push(workoutRecord);

            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('workoutHistory', JSON.stringify(workoutHistory));

            alert('è¿åŠ¨è®°å½•å·²ä¿å­˜ï¼');

            // è¿”å›è¿åŠ¨æ¨èé¡µé¢
            window.location.href = 'exercise.html';
        }

        // è¿”å›ä¸Šä¸€é¡µ
        function goBack() {
            if (workoutState.isActive) {
                const confirm = window.confirm('è¿åŠ¨æ­£åœ¨è¿›è¡Œä¸­ï¼Œç¡®å®šè¦é€€å‡ºå—ï¼Ÿ');
                if (!confirm) return;
            }

            window.location.href = 'exercise.html';
        }

        // é¡µé¢å¸è½½æ—¶æ¸…ç†
        window.addEventListener('beforeunload', function() {
            stopTimers();
        });
    </script>
</body>
</html>